<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  lang="es"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" th:href="@{/css/output.css}" />
    <title>Home</title>
  </head>
  <body class="bg-teal-400 relative text-zinc-900">
    <div th:replace="~{layout/layout :: logout}"></div>
    <nav th:replace="~{layout/layout :: navigation}"></nav>
    <div
      class="w-full h-max md:flex justify-start items-start py-6 px-8 flex-row gap-3 text-zinc-300 bg-teal-800 rounded-b-lg"
    >
      <span class="text-xl font-bold text-center text-balance mt-5"
        >Busca el producto:</span
      >
      <form action="#" method="get" class="w-[40%] mb-2 md:mb-0 md:w-1/5">
        <input
          onkeydown="return handleKeyPress(event)"
          type="search"
          name="search"
          id="searchInput"
          oninput="buscarProducto()"
          placeholder="Introduzca el nombre de un producto"
          class="p-2 rounded-lg mt-3 border-2 border-zinc-100 bg-zinc-200/80 outline-teal-500 text-zinc-500 font-semibold w-11/12 md:w-full"
          onsubmit="return false;"
        />
      </form>
      <hr />
      <form
        action="#"
        method="get"
        class="w-auto md:w-[60%] flex justify-center items-start gap-3"
      >
        <select
          class="p-2 rounded-lg mt-3 border-2 border-zinc-100 bg-zinc-200/80 outline-teal-700 text-zinc-500 font-semibold w-1/2 md:w-3/4 h-min md:hidden block"
          name="productos"
          id="productos"
        >
          <option th:if="${producto}" th:text="${producto}"></option>
          <option th:if="${opcion}" th:text="${opcion}"></option>
          <option
            th:if="${productos}"
            th:each="producto : ${productos}"
            th:value="${producto.idProducto}"
            th:text="${producto.nombreProducto + ' - ' + producto.precioProducto}"
          ></option>
        </select>
        <select
          class="p-2 rounded-lg mt-3 border-2 border-zinc-100 bg-zinc-200/80 outline-teal-700 text-zinc-500 font-semibold w-1/2 md:w-3/4 h-max md:block hidden"
          size="2"
          name="productosDos"
          id="productosDos"
        >
          <option
            th:if="${producto}"
            th:text="${producto}"
            class="w-full p-2 rounded-lg hover:bg-zinc-500 hover:text-zinc-200"
          ></option>
          <option
            th:if="${opcion}"
            th:text="${opcion}"
            class="w-full p-2 rounded-lg hover:bg-zinc-500 hover:text-zinc-200"
          ></option>
          <option
            th:if="${productos}"
            th:each="producto : ${productos}"
            th:value="${producto.idProducto}"
            th:text="${producto.nombreProducto + ' - ' + producto.precioProducto}"
            class="w-full p-2 rounded-lg hover:bg-zinc-500 hover:text-zinc-200"
          ></option>
        </select>

        <button
          class="p-2 rounded-lg mt-3 border-2 border-zinc-100 bg-zinc-200/80 outline-zinc-700 text-zinc-500 font-semibold h-max hover:bg-zinc-500 hover:text-zinc-200 hover:scale-105 hover:border-zinc-100/30 transition-all"
          onclick="AddProduct()"
          type="button"
        >
          Agregar a la venta
        </button>
      </form>
    </div>
    <div class="flex flex-row w-screen justify-evenly p-4 h-max">
      <div
        id="venta"
        class="bg-teal-600 h-auto w-1/2 md:w-full p-3 flex flex-col gap-3 rounded-l-lg"
      >
        <span
          th:each="producto : ${productos}"
          th:value="${producto.idProducto}"
          th:text="${producto.nombreProducto + ' - ' + producto.precioProducto}"
        ></span>
      </div>
      <div
        id="venta"
        class="bg-teal-700 h-auto w-full p-3 flex flex-col gap-3 rounded-r-lg"
      >
        <span
          th:each="producto : ${productos}"
          th:value="${producto.idProducto}"
          th:text="${producto.nombreProducto + ' - ' + producto.precioProducto}"
        ></span>
      </div>
    </div>
    <script>
      function handleKeyPress(event) {
        // Evitar el env√≠o del formulario cuando se presiona Enter
        if (event.key === "Enter") {
          event.preventDefault();
        }
      }
      function buscarProducto(keyword) {
        var keyword = document.getElementById("searchInput").value;
        // Realizar solicitud AJAX
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/search?search=" + keyword, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            // Actualizar la interfaz de usuario con los resultados
            var resultadosDiv = document.getElementById("productos");

            var resultadosDivDos = document.getElementById("productosDos");
            resultadosDiv.innerHTML = generarHTMLResultados(
              JSON.parse(xhr.responseText)
            );
            resultadosDivDos.innerHTML = generarHTMLResultados(
              JSON.parse(xhr.responseText)
            );
          }
        };
        xhr.send();
      }

      function AddProduct() {
        // Realizar solicitud AJAX
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/products", true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            // Actualizar la interfaz de usuario con los resultados
            var resultadosDiv = document.getElementById("productos");
            resultadosDiv.innerHTML = generarHTMLResultados(
              JSON.parse(xhr.responseText)
            );
            resultadosDivDos.innerHTML = generarHTMLResultados(
              JSON.parse(xhr.responseText)
            );
          }
        };
        xhr.send();
      }

      function generarHTMLResultados(resultados) {
        // Generar HTML para mostrar los resultados
        var html =
          resultados.length == 0
            ? "<option value='null' class='w-full p-2 rounded-lg hover:bg-zinc-500 hover:text-zinc-200' disabled>No se encontraron resultados</option><option value='null' class='w-full p-2 rounded-lg hover:bg-zinc-500 hover:text-zinc-200' disabled>Busque nuevamente</option>"
            : "";
        resultados.forEach(function (producto) {
          html +=
            "<option class='w-full p-2 rounded-lg hover:bg-zinc-500 hover:text-zinc-200' value='" +
            producto.idProducto +
            "'>" +
            producto.nombreProducto +
            " - " +
            producto.precioProducto +
            "</option>";
        });
        return html;
      }
    </script>
  </body>
</html>
